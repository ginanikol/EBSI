![EBSI Logo](https://ec.europa.eu/cefdigital/wiki/images/logo/default-space-logo.svg)

# EBSI API Problem Details Errors Library

> Normalize EBSI API errors with Problem Details.

## Table of Contents

1. [Installation](#Installation)
2. [Usage](#Usage)
3. [Testing](#Testing)
4. [Licensing](#Licensing)

## Installation

```sh
npm install @cef-ebsi/problem-details-errors
```

or if you use `yarn`

```sh
yarn add @cef-ebsi/problem-details-errors
```

## Usage

Classes available:

- `ProblemDetailsError`: Generic class
- `BadRequestError` (400)
- `UnauthorizedError` (401)
- `PaymentRequiredError` (402)
- `ForbiddenError` (403)
- `NotFoundError` (404)
- `MethodNotAllowedError` (405)
- `NotAcceptableError` (406)
- `ProxyAuthenticationRequiredError` (407)
- `RequestTimeoutError` (408)
- `ConflictError` (409)
- `GoneError` (410)
- `LengthRequiredError` (411)
- `PreconditionFailedError` (412)
- `PayloadTooLargeError` (413)
- `UriTooLongError` (414)
- `UnsupportedMediaTypeError` (415)
- `RangeNotSatisfiableError` (416)
- `ExpectationFailedError` (417)
- `LockedError` (423)
- `PreconditionRequiredError` (428)
- `TooManyRequestsError` (429)
- `InternalServerErrorError` (500)
- `NotImplementedError` (501)
- `ServiceUnavailableError` (503)

Import the class you want to use, e.g.:

```js
import { NotFoundError } from "@cef-ebsi/problem-details-errors";
```

Then throw a new error:

```js
// Without any params
throw new NotFoundError();
// the Problem Details document looks like this: { title: 'Not Found', status: 404 }

// With a title only
throw new NotFoundError("Record not found");
// -> { title: 'Record not found', status: 404 }
```

You can also set the different properties of a Problem Details document: "type", "detail" and "instance":

```js
throw new NotFoundError("Record not found.", {
  detail: "Couldn't find any record matching ID 123",
});
// -> { title: 'Record not found.', status: 404, detail: "Couldn't find any record matching ID 123" }
```

If you want to add custom attributes to the Problem Details error, use `options.extensions`:

```js
throw new NotFoundError("Record not found.", {
  extensions: {
    "invalid-params": [
      {
        name: "age",
        reason: "must be a positive integer",
      },
      {
        name: "color",
        reason: "must be 'green', 'red' or 'blue'",
      },
    ],
  },
});
// ->
// {
//   title: 'Record not found.',
//   status: 404,
//   'invalid-params': [
//     { name: 'age', reason: 'must be a positive integer' },
//     { name: 'color', reason: "must be 'green', 'red' or 'blue'" }
//   ]
// }
```

If you want to get the JSON representation of the Error, use the `.toJSON()` method:

```js
const error = new NotFoundError();
const jsonError = error.toJSON();
// jsonError is now equal to { title: 'Not Found', status: 404 }
```

If you want the string representation, use the `.toString()` method:

```js
const error = new NotFoundError();
const stringError = error.toString();
// stringError is now equal to: 404 - Not Found
```

## Testing

Run:

```sh
yarn test
```

## Licensing

Copyright (c) 2019 European Commission
Licensed under the EUPL, Version 1.2 or - as soon they will be approved by the European Commission - subsequent versions of the EUPL (the "Licence");
You may not use this work except in compliance with the Licence.
You may obtain a copy of the Licence at:

- <https://joinup.ec.europa.eu/page/eupl-text-11-12>

Unless required by applicable law or agreed to in writing, software distributed under the Licence is distributed on an "AS IS" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the Licence for the specific language governing permissions and limitations under the Licence.
